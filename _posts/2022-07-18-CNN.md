---
layout: single
title: "합성곱 신경망(CNN)"
category: DL
tag: [python, DeepLearning]
toc: true
toc_sticky: true
use_math: true
---

# 합성곱 신경망(Convolution Neural Network)

* 합성곱 신경망 또는 CNN은 뇌의 시각 피질이 물체를 인식할 때 동작하는 방식에서 영감을 얻은 모델

## CNN과 특성 계층 학습

CNN과 같은 종류의 신경망은 원본 데이터에서 작업에 가장 유용한 특성을 자동으로 학습할 수 있다.
* CNN층을 특성 추출기로 생각하기도 한다.
* (MLP나 FC_Layer)뒤쪽의 층은 이런 특성을 사용하여 연속적인 타깃 값이나 클래스 레이블을 예측한다.
* CNN은 입력이미지에서 feature map을 만든다.
![image.png](attachment:image.png)

CNN은 이미지 관련 작업을 매우 잘 수행한다.
* **희소연결** : feature map에 있는 하나의 원소는 작은 픽셀 패치 하나에만 연결됨.
* **파라미터 공유** : 동일한 가중치가 입력이미지의 모든 패치에 사용된다.  

두 아이디어로 MLP를 합성곱 층으로 바꾸면 파라미터 개수가 감소하고 중요 특징을 잡아내는 능력이 향상된다.  
이미지 데이터를 보면 가까이 있는 픽셀들이 멀리있는 픽셀보다 연관성이 높다고 가정할 수 있다.

CNN은 여러 개의 합성곱(Conv)층과 풀링(Pooling, P)이라고 하는 서브샘플링(subsampling)층으로 이루어져 있다.
* Pooling Layer로 알려진 subsampling층은 학습되는 파라미터가 없다.

## 이산 합성곱
* CNN의 기본연산 (1차원 텐서(벡터)나 2차원 텐서(행렬))

### 1차원 이산 합성곱

* x = 입력, w = 필터 or 커널 , $*$는 벡터나 행렬간의 합성곱 연산을 의미
![image-2.png](attachment:image-2.png)

x가 0 ~ 9의 인덱스로 열 개의 특성을 가지고 있다면 무한대의 범위는 x의 범위 밖이다.  
덧셈을 올바르게 계산하기 위해서는 x와 w가 0으로 채워져 있다고 가정해야한다. -> 유한한 개수의 0으로 x가 패딩된다.
* 제로패딩 혹은 패딩이라고 한다.

![image.png](attachment:image.png)

입력 x와 필터 w가 각각 n개, m개의 원소를 가지고 m<=n이라면 공식은 아래와 같다.

![image.png](attachment:image.png)

### 1차원 합성곱

![image.png](attachment:image.png)

* 1단계 : 필터를 뒤집는다.
* 2단계 : 출력원소에 대한 점곱을 계산한다 ( 2칸씩 필터를 이동한다 )

* 이동하는 양은 stride라고 하며 합성곱 하이퍼파라미터이다. 위 그림에서 stride=2이다.

### 패딩
* 풀패딩(full padding) : p = m-1로 설정한다. 풀 패딩은 출력 크기를 증가시키기 때문에 합성곱신경망 구조에서는 거의 사용되지 않는다.
* 세임패딩(same padding) : 출력크기가 입력벡터 x와 같아야 할 때 사용한다. 파라미터 p는 필터 크기에 따라 결정된다.
* 밸리드패팅(valid padding) : p = 0인 경우를 말한다.

![image.png](attachment:image.png)

### 합성곱 출력 크기 계산

* 입력 벡터의 크기 : n
* 필터 크기 : m
* 패딩 : p
* 스트라이드 : s
![image.png](attachment:image.png)

#### Quiz
* 입력 벡터의 크기가 10이고 합성곱 커널 크기가 5, 패딩이 2, 스트라이드가 1일 때 출력의 크기
    * 10(same padding)  
    
* 입력 벡터의 크기가 10이고 합성곱 커널 크기가 3, 패딩이 2, 스트라이드가 2일 때 출력의 크기
    * 6

### 2차원 이산 합성곱

1차원 합성곱의 개념을 이용해 2차원으로 확장
* 제로패딩, 필터, 스트라이드 같은 기법을 2D 합성곱에 적용할 수 있다.
* 8x8입력 행렬, 3x3커널을 사용한 2D합성곱
![image.png](attachment:image.png)

#### 2D 합성곱 계산
* 입력행렬 3x3, 커널행렬 3x3

![image.png](attachment:image.png)

![image.png](attachment:image.png)

## 서브샘플링

* 최대 풀링(max pooling)
* 평균 풀링(average pooling)

![image.png](attachment:image.png)

풀링의 장점
* 풀링은 지역 불변성을 만든다. : 작은 변화가 maxpooling의 결과를 바꾸지 못한다.
* 풀링은 특성 크기를 줄이므로 계산 효율성을 높인다. 또 특성 개수가 줄어들면 과대적합도 감소한다.

$$a^2 = b^2$$
